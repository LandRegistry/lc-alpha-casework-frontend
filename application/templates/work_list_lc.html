{% extends "/page_template/base.html" %}
{% block page_specific_head %}
<link href="/static/datatables/css/jquery.dataTables.css" rel="stylesheet" />
<link href="/static/datatables/css/dataTables.responsive.css" rel="stylesheet" />
<script type="text/javascript" src="/static/datatables/js/jquery.dataTables.js"></script>
<script>
 HOST = window.location.protocol + "//" + window.location.hostname;

$(document).ready(function() {
    $("#refresh").hide();
    setInterval("getTotals()", 30000);
    $('#work-list').DataTable({info: false, paging: false, searching: false});
    $('#work-list tbody tr').click(function() {
        var href = $(this).find("a").attr("href");
        if(href) {
            window.location = href;
        }
    });

} );

function getTotals(){

    jQuery.ajax( {
        url: HOST + ':5010/totals',
        type: 'GET',
        data: {},
        success: function( data ) {
            var lc_regn = document.getElementById('lc_regn').querySelector('span');
            var lc_pn = document.getElementById('lc_pn').querySelector('span');
            var lc_rect = document.getElementById('lc_rect').querySelector('span');
            var lc_renewal = document.getElementById('lc_renewal').querySelector('span');
            var lc_stored = document.getElementById('lc_stored').querySelector('span');

            var numBankReg = data.lc_regn;
            var numBankAmend = data.lc_pn;
            var numBankRect = data.lc_rect;
            var numBankWith = data.lc_renewal;
            var numBankStore = data.lc_stored;
            var numAmend = data.lc_pn;


            lc_regn.className = numBankReg < 10 ? 'indicator_middle' : 'indicator_middle_2';
            lc_pn.className = numBankAmend < 10 ? 'indicator_middle' : 'indicator_middle_2';
            lc_rect.className = numBankRect < 10 ? 'indicator_middle' : 'indicator_middle_2';
            lc_renewal.className = numBankWith < 10 ? 'indicator_middle' : 'indicator_middle_2';
            lc_stored.className = numBankStore < 10 ? 'indicator_middle' : 'indicator_middle_2';

            lc_regn.textContent = numBankReg;
            lc_pn.textContent = numBankAmend;
            lc_rect.textContent = numBankRect;
            lc_renewal.textContent = numBankWith;
            lc_stored.textContent = numBankStore;

        }
    } );

}

</script>
{% endblock %}

{% block maincontent %}

<input type="hidden" name="requested_list" value="{{requested_list}}"/>


{% if requested_list == 'lc_regn' %}
{% set page_title = 'Registration' %}
{% set regn_selected = 'selected' %}
{% elif requested_list == 'lc_pn' %}
{% set page_title = 'Priority Notice' %}
{% set pn_selected = 'selected' %}
{% elif requested_list == 'lc_rect' %}
{% set page_title = 'Rectification' %}
{% set rect_selected = 'selected' %}
{% elif requested_list == 'lc_renewal' %}
{% set page_title = 'Renewals' %}
{% set renewal_selected = 'selected' %}
{% elif requested_list == 'lc_stored' %}
{% set page_title = 'Stored' %}
{% set stored_selected = 'selected' %}
{% endif %}
<div class="breadcrumb">
    <ol>
        <li><a href="/">Home</a></li>
        {% if requested_list == "lc" %}
            <li class="breadcrumb_no_arrow"><span>Land Charge</span></li>
        {% else %}
            <li><a href="/get_list?appn=bank">Land Charge</a></li>
            <li class="breadcrumb_no_arrow"><span>{{page_title}}</span></li>
        {% endif %}
    </ol>
</div>

<div class="spacer_5"></div>
<div class="grid-row" >

    <!-- Side Navigation -->
    <div class="col three">
        <ul id="side-nav">
            <li><a href="/">Home</a></li>
            <li><a href="/get_list?appn=bank">Bankruptcy Applications</a></li>
            <li><a class="active" href="/get_list?appn=lc">Land Charge Applications</a></li>
            <li><a href="/get_list?appn=search">Searches</a></li>
            <li><a href="/get_list?appn=cancel">Cancellations</a></li>
            <li><a href="/get_list?appn=search">Office Copies</a></li>
            <li><a href="uc">Enquiries</a></li>
            <li><a href="uc">Image management</a></li>
            <li><a href="uc">General Information</a></li>
        </ul>
    </div>

    <!-- Content -->
    <div class="col nine" style="min-width:800px;">
        <div class="spacer_10"></div>
        <h1 class="title_36">Land Charge</h1>
        <div class="spacer_20"></div>
        <!-- Totals -->
        <div class="grid-row">
            <div class="subservice_box no-margin">
            <a class="no_link_style {{regn_selected}}"  href="/get_list?appn=lc_regn">
                <div class="spacer_20"></div>
                <p class="text_16_bold">Registrations</p>
                <div class="spacer_30"></div>
                <div class="indicator" id="lc_regn">
                    {% if data['lc_regn'] < 10 %}
                    <span class="indicator_middle">{{data['lc_regn']}}</span>
                    {% else %}
                    <span class="indicator_middle_2">{{data['lc_regn']}}</span>
                    {% endif %}
                </div>
            </a>
            </div>

            <div class="subservice_box">
                <a class="no_link_style {{amend_selected}}" href="/get_list?appn=lc_pn">
                <div class="spacer_20"></div>
                <p class="text_16_bold">Priority Notices</p>
                <div class="spacer_30"></div>
                <div class="indicator" id="lc_pn">
                    {% if data['lc_pn'] < 10 %}
                    <span class="indicator_middle">{{data['lc_pn']}}</span>
                    {% else %}
                    <span class="indicator_middle_2">{{data['lc_pn']}}</span>
                    {% endif %}
                </div>
                </a>
            </div>

            <div class="subservice_box">
                <a class="no_link_style  {{rect_selected}}" href="/get_list?appn=lc_rect">
                    <div class="spacer_20"></div>
                    <p class="text_16_bold">Rectifications</p>
                    <div class="spacer_30"></div>
                    <div class="indicator" id="lc_rect">
                        {% if data['lc_rect'] < 10 %}
                        <span class="indicator_middle">{{data['lc_rect']}}</span>
                        {% else %}
                        <span class="indicator_middle_2">{{data['lc_rect']}}</span>
                        {% endif %}
                    </div>
                </a>
            </div>

            <div class="subservice_box">
                <a class="no_link_style {{with_selected}}" href="/get_list?appn=lc_renewal">
                    <div class="spacer_20"></div>
                    <p class="text_16_bold">Renewals</p>
                    <div class="spacer_30"></div>
                    <div class="indicator" id="lc_renewal">
                        {% if data['lc_renewal'] < 10 %}
                        <span class="indicator_middle">{{data['lc_renewal']}}</span>
                        {% else %}
                        <span class="indicator_middle_2">{{data['lc_renewal']}}</span>
                        {% endif %}
                    </div>
                </a>
            </div>

            <div class="subservice_box">
                <a class="no_link_style {{stored_selected}}" href="/get_list?appn=lc_stored">
                    <div class="spacer_20"></div>
                    <p class="text_16_bold">Stored Applications</p>
                    <div class="spacer_30"></div>
                    <div class="indicator" id="lc_stored">
                        {% if data['lc_stored'] < 10 %}
                        <span class="indicator_middle">{{data['lc_stored']}}</span>
                        {% else %}
                        <span class="indicator_middle_2">{{data['lc_stored']}}</span>
                        {% endif %}
                    </div>
                </a>
            </div>
        </div>

        <!-- List of pending applications -->
        {% if worklist|length > 0 %}
        <div class="grid-row">
            <div class="spacer_15"></div>
            <h2 class="text_24_bold">{{page_title}} applications</h2>
            <div class="spacer_15"></div>
            <div style="margin-left:0px; float: left;  width: 75%;">
                <table id="work-list" class="hover">
                    <thead>
                    <tr>
                        <th class="table_text_black">Date and time received <a href="#"></a></th>
                        <th class="table_text_black">Form type <a href="#"></a></th>
                    </tr>
                    </thead>
                    {% for n in worklist %}
                    <tbody>
                    <tr>
                        <td>{{n['date_received']}} {{n['time_received']}}</td>
                        <td>
                            <a id="appn_type{{loop.index}}" href="/application_start/{{requested_list}}/{{n['appn_id']}}/{{n['application_type']|replace(' ', '%20')}}">
                                {% if n['application_type'] == 'WO(B)' %}
                                WOB
                                {% elif n['application_type'] == 'PA(B)'%}
                                PAB
                                {% else %}
                                {{n['application_type']}}
                                {% endif %}
                            </a>
                        </td>
                    </tr>
                    </tbody>
                    {% endfor %}
                </table>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}